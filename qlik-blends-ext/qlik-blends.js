define(["qlik","translator","./dist/qlik-blends","./nlib/@nebula.js/stardust/dist/stardust"],(function(e,t,n,i){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=o(e),r=o(t),a=o(n);function l(e,t,n,i,o,s,r){try{var a=e[s](r),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(i,o)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var s=e.apply(t,n);function r(e){l(s,i,o,r,a,"next",e)}function a(e){l(s,i,o,r,a,"throw",e)}r(void 0)}))}}var p="98c97bb0-5b07-11eb-bfda-35143d78df5c",u=8473,d="n3lFBh1JTBU9MfkuBE3YzQQj1LPBL2Jq",m="https://api.blendr.io/v1";function h(e){return new Promise(function(){var t=c(regeneratorRuntime.mark((function t(n,i){var o,s,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o={method:"GET",headers:{"X-App-Id":u,"X-Api-Key":d}},s="".concat(m,"/").concat(e.replace("account_externalid",p)),t.next=6,fetch(s,o);case 6:if(200!==(r=t.sent).status){t.next=15;break}return t.t0=n,t.next=11,r.json();case 11:t.t1=t.sent,(0,t.t0)(t.t1),t.next=16;break;case 15:i(r.status);case 16:t.next=22;break;case 18:t.prev=18,t.t2=t.catch(0),i(err),console.error(err);case 22:case"end":return t.stop()}}),t,null,[[0,18]])})));return function(e,n){return t.apply(this,arguments)}}())}var f=function(){var e=c(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h("accounts/account_externalid/blends");case 2:return t=e.sent,e.abrupt("return",t.data.map((function(e){return{value:e.guid,label:e.name}})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b={definition:{type:"items",component:"accordion",items:{dimensions:{uses:"dimensions",min:0,max:20},measures:{uses:"measures",min:0,max:20},config:{type:"items",label:"Form",component:"items",items:{objects:{ref:"itemsList",label:"Items",type:"items",items:{objects:{type:"array",ref:"items",label:"Items",itemTitleRef:function(e){return e.ref},allowAdd:!0,allowRemove:!0,allowMove:!0,addTranslation:"Add items",items:{component:{label:"Item type",component:"expression-with-dropdown",dropdownOnly:!0,type:"string",ref:"component",defaultValue:"",options:[{value:"checkbox",label:"Checkbox"},{value:"datePicker",label:"Date picker"},{value:"dropdown",label:"Dropdown"},{value:"dropdownMultiple",label:"Dropdown multiple select"},{value:"numberInput",label:"Number"},{value:"slider",label:"Slider"},{value:"switch",label:"Switch"},{value:"textInput",label:"Text"}]},defaultValue:{type:"string",ref:"defaultValue",label:"Default value",defaultValue:"",expression:"optional"},step:{type:"number",ref:"step",label:"Step",defaultValue:1,expression:"optional",show:function(e){if("slider"===e.component)return!0}},min:{type:"number",ref:"min",label:"Min",defaultValue:0,expression:"optional",show:function(e){if("slider"===e.component)return!0}},max:{type:"number",ref:"max",label:"Max",defaultValue:10,expression:"optional",show:function(e){if("slider"===e.component)return!0}},dropdownOptions:{type:"string",ref:"dropdownOptions",label:"Dropdown values",defaultValue:"",expression:"optional",show:function(e){if("dropdown"===e.component||"dropdownMultiple"===e.component)return!0}},explainDropdown:{label:"Enter dropdown values using a comma as a seperator",component:"text",show:function(e){if("dropdown"===e.component||"dropdownMultiple"===e.component)return!0}},width:{type:"number",component:"slider",label:"Width",ref:"width",min:10,max:100,step:1,defaultValue:100},alignment:{component:"item-selection-list",type:"string",ref:"alignment",translation:"properties.Alignment",horizontal:!0,defaultValue:"left",items:[{component:"icon-item",icon:"align_left",value:"left",translation:"properties.dock.left",labelPlacement:"bottom"},{component:"icon-item",icon:"align_center",value:"center",translation:"Common.Center",labelPlacement:"bottom"},{component:"icon-item",icon:"align_right",value:"right",translation:"properties.dock.right",labelPlacement:"bottom"}]},label:{type:"string",ref:"label",label:"Label",defaultValue:"Label",expression:"optional"},ref:{type:"string",ref:"ref",label:"Reference",defaultValue:function(){return Math.random().toString(36).substr(2,5)},expression:"optional"},explainRef:{label:"The reference is used as a key when sending the data to your blend",component:"text"},required:{ref:"required",type:"boolean",component:"switch",translation:"Required input",options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}],defaultValue:!1}}}}}}},blend:{type:"items",label:"Blend",component:"items",items:{blends:{label:"Select a blend",component:"expression-with-dropdown",dropdownOnly:!0,type:"string",ref:"blend.id",defaultValue:"",options:function(){return f()}},buttonLabel:{type:"string",ref:"blend.buttonLabel",label:"Button label",defaultValue:"Run blend",expression:"optional"},runningBlendLabel:{type:"string",ref:"blend.runningBlendLabel",label:"Button loading message",defaultValue:"Running blend...",expression:"optional"},buttonWidth:{type:"number",component:"slider",label:"Button width",ref:"blend.buttonWidth",min:10,max:100,step:1,defaultValue:100},buttonAlignment:{component:"item-selection-list",type:"string",ref:"alignment",translation:"properties.Alignment",horizontal:!0,defaultValue:"left",items:[{component:"icon-item",icon:"align_left",value:"left",translation:"properties.dock.left",labelPlacement:"bottom"},{component:"icon-item",icon:"align_center",value:"center",translation:"Common.Center",labelPlacement:"bottom"},{component:"icon-item",icon:"align_right",value:"right",translation:"properties.dock.right",labelPlacement:"bottom"}]},useCondition:{type:"boolean",component:"switch",translation:"Condition to enable blend",ref:"blend.useEnabledCondition",defaultValue:!1,options:[{value:!0,translation:"properties.on"},{value:!1,translation:"properties.off"}]},condition:{ref:"blend.enabledCondition",translation:"properties.enableCondition",type:"integer",expression:"optional",show:function(e){return e.blend.useEnabledCondition}}}},settings:{uses:"settings",items:{general:{type:"items",translation:"properties.general",items:{showTitles:{},details:{show:!1},label:{component:"string",ref:"style.label",translation:"Common.Label",expression:"optional"}}},theme:{grouped:!0,type:"items",translation:"Theme",items:{colorPickerPrimary:{component:"color-picker",type:"object",ref:"blendGlobalTheme.primaryColor",translation:"Primary color",dualOutput:!0,defaultValue:{color:"ff5866",index:"-1"}},colorPickerSecondary:{component:"color-picker",type:"object",ref:"blendGlobalTheme.secondaryColor",translation:"Secondary color",dualOutput:!0,defaultValue:{color:"ff5866",index:"-1"}},variant:{label:"Variant type",component:"dropdown",type:"string",ref:"blendGlobalTheme.variant",defaultValue:"standard",options:[{value:"filled",label:"Filled"},{value:"outlined",label:"Outlined"},{value:"standard",label:"Standard"}]}}}}}}},support:{export:!0,exportData:!0,snapshot:!0,viewData:!0}};const v=1;function g(e,t){const n=[];return function(e){return!!e.tooltips||e.interactionState===v&&!1!==e.tooltips}(e)&&n.push("passive"),e.interactionState===v&&!1!==e.tooltips&&!0!==e.limitedInteraction&&n.push("interact"),t.isSnapshot||(!1!==e.selections&&n.push("select"),n.push("fetch")),n}var y={};function w(){w.init.call(this)}y.isObject=function(e){return"object"==typeof e&&null!==e},y.isNumber=function(e){return"number"==typeof e},y.isUndefined=function(e){return void 0===e},y.isFunction=function(e){return"function"==typeof e};var x=w;w.EventEmitter=w,w.prototype._events=void 0,w.prototype._maxListeners=void 0,w.defaultMaxListeners=10,w.init=function(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0},w.prototype.setMaxListeners=function(e){if(!y.isNumber(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},w.prototype.emit=function(e){var t,n,i,o,s,r;if(this._events||(this._events={}),"error"===e&&!this._events.error)throw(t=arguments[1])instanceof Error?t:Error('Uncaught, unspecified "error" event.');if(n=this._events[e],y.isUndefined(n))return!1;if(y.isFunction(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,o=new Array(i-1),s=1;s<i;s++)o[s-1]=arguments[s];n.apply(this,o)}else if(y.isObject(n)){for(i=arguments.length,o=new Array(i-1),s=1;s<i;s++)o[s-1]=arguments[s];for(i=(r=n.slice()).length,s=0;s<i;s++)r[s].apply(this,o)}return!0},w.prototype.addListener=function(e,t){var n;if(!y.isFunction(t))throw TypeError("listener must be a function");(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,y.isFunction(t.listener)?t.listener:t),this._events[e]?y.isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,y.isObject(this._events[e])&&!this._events[e].warned)&&((n=y.isUndefined(this._maxListeners)?w.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,y.isFunction(console.error)&&console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),y.isFunction(console.trace)&&console.trace()));return this},w.prototype.on=w.prototype.addListener,w.prototype.once=function(e,t){if(!y.isFunction(t))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}return i.listener=t,this.on(e,i),this},w.prototype.removeListener=function(e,t){var n,i,o,s;if(!y.isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,i=-1,n===t||y.isFunction(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(y.isObject(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){i=s;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},w.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],y.isFunction(n))this.removeListener(e,n);else if(Array.isArray(n))for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},w.prototype.listeners=function(e){return this._events&&this._events[e]?y.isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},w.listenerCount=function(e,t){return e._events&&e._events[t]?y.isFunction(e._events[t])?1:e._events[t].length:0};var _=e=>{const t={begin(){e.selectionsApi.activated(),e.backendApi.beginSelections(),t.emit("activated")},clear(){e.backendApi.model.resetMadeSelections()},confirm(){e.selectionsApi.confirm()},cancel(){e.selectionsApi.cancel()},select(t){e.selectionsApi.active||e.backendApi.beginSelections(),e.backendApi.model[t.method](...t.params).then((t=>{t||(e.selectionsApi.selectionsMade=!1,this.clear())})),e.selectionsApi.selectionsMade="resetMadeSelections"!==t.method},isActive:()=>e.selectionsApi.active,refreshToolbar(){e.selectionsApi.refreshToolbar()}};var n;return n=t,Object.keys(x.prototype).forEach((e=>{n[e]=x.prototype[e]})),x.init(n),e.selectionsApi.confirm=()=>{e.backendApi.endSelections(!0).then((()=>{e.selectionsApi.deactivated(),t.emit("deactivated")}))},e.selectionsApi.clear=()=>{e.backendApi.clearSelections(),e.selectionsApi.selectionsMade=!1,t.emit("cleared")},e.selectionsApi.cancel=()=>{e.backendApi.endSelections(!1),e.selectionsApi.deactivated(),t.emit("canceled")},t};const{generator:A,theme:k,locale:L}=i.__DO_NOT_USE__,C=L({initial:r.default.language}),S={translator:{...C.translator,get(e,t){const n=r.default.get(e,t);return n===e?C.translator.get(e,t):n}},flags:{isEnabled:()=>!1},anything:{}},T=["viewState","direction","renderer"];function V(e,t){const n={};let i=!1;return Object.keys(e).forEach((o=>{-1!==T.indexOf(o)&&(n[o]=e[o],t[o]!==e[o]&&(i=!0))})),i?n:t}function O(e){return s.default.currApp(e).theme.getApplied().then((t=>{e.nTheme.externalAPI.name()!==t.id&&e.nTheme.internalAPI.setTheme(t.properties,t.id)}))}const I=A(a.default,S),P=b||{};let j;if(I.qae.data.targets[0]){const e=I.qae.data.targets[0],t=e=>({...e,add:e.added,remove:e.removed,replace:e.replaced,move:e.moved});j={},e.dimensions&&(j.dimensions=t(e.dimensions)),e.measures&&(j.measures=t(e.measures))}return{definition:{type:"items",component:"accordion",items:{data:j?{uses:"data"}:void 0,sorting:j?{uses:"sorting"}:void 0,settings:{uses:"settings"}}},data:j,getSelectionToolbar(){return[...this.senseItems,{name:"Tooltip.clearSelection",tid:"selection-toolbar.clear",isIcon:!0,buttonClass:"clear",iconClass:"lui-icon lui-icon--clear-selections",action:function(){this.selectionsApi.clear()},isDisabled:function(){return!this.selectionsApi.selectionsMade}}]},...P,initialProperties:I.qae.properties.initial,template:'<div style="height: 100%;position: relative"></div>',mounted(e){const t=e[0].children[0],n=_(this.$scope),i=I.create({model:this.backendApi.model,app:this.backendApi.model.session.app,selections:n,explicitResize:!0});this.sn=i,this.snComponent=i.component,this.snComponent.created(),this.snComponent.mounted(t),this.senseItems=[];const{senseItems:o}=this;this.snComponent.observeActions((e=>{o.length=0,o.push(...function(e){return e.map((e=>{const t={isIcon:!0,buttonClass:"sel-toolbar-icon-toggle",isActive:()=>e.active,isDisabled:()=>e.disabled,action(){e.action()},getSvgIcon(){const t=e.getSvgIconShape(),{viewBox:n="0 0 16 16"}=t;return`<i style="display:inline-block;font-style:normal;line-height:0;text-align:center;text-transform:none;vertical-align:-.2em;text-rendering:optimizeLegibility;web-kit-font-smoothing:antialiased;moz-osx-font-smoothing:grayscale"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="${n}" fill="currentColor">${t.shapes.map((({type:e,attrs:t})=>`<${e} ${Object.keys(t).map((e=>`${e}="${t[e]}"`)).join(" ")}/>`)).join("")}</svg></i>`}};return Object.defineProperties(t,{name:{get:()=>e.label},hidden:{get:()=>e.hidden}}),t}))}(e)),this.$scope.selectionsApi.refreshToolbar()})),this.nTheme=k(),this.initiatedTheme=O(this)},suppressOnPaint:()=>!1,paint(){const e=g(this.options,this.backendApi),t={passive:-1===e.indexOf("passive")||void 0,active:-1===e.indexOf("interact")||void 0,select:-1===e.indexOf("select")||void 0},n=V(this.options,this.snComponent.context.options);return this._pureLayout=this.backendApi.model.pureLayout||this.backendApi.model.layout,this.initiatedTheme.then((()=>(O(this),this.snComponent.render({layout:this.backendApi.model.pureLayout||this.backendApi.model.layout,context:{appLayout:{qLocaleInfo:this.backendApi.localeInfo},constraints:t,theme:this.nTheme.externalAPI},options:n}))))},resize(){if(this._pureLayout!==this.backendApi.model.pureLayout)return this.paint();const e=V(this.options,this.snComponent.context.options);return this.snComponent.context.options=e,this.snComponent.resize()},setInteractionState(){this.paint()},setSnapshotData(e){return this.snComponent.setSnapshotData(e)},getViewState(){const e=this.snComponent.getImperativeHandle();if(e&&"function"==typeof e.getViewState)return e.getViewState()},destroy(){this.sn.destroy(),this.snComponent&&(this.snComponent.willUnmount(),this.snComponent.destroy())}}}));
